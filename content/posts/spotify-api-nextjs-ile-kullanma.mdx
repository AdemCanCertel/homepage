---
title: Spotify API'sini Next.js ile kullanma
excerpt: Bir Next.js API yoluyla dinlediÄŸin parÃ§alarÄ± getirmek iÃ§in Spotify API ile nasÄ±l kimlik doÄŸrulamasÄ± yapacaÄŸÄ±nÄ±zÄ± Ã¶ÄŸrenin
image: Spotify-API.png
category:
  - api
author:
  - ademcancertel
featured: true
date: "24.08.2022"
---

Web sitemin en sevdiÄŸim bÃ¶lÃ¼mlerinden birisi [aktiviteler](/activites) yeni teknoloji API'leri denemek iÃ§in de gÃ¼zel bir bÃ¶lÃ¼m olduÄŸu denebilir. Åžu anda Steam, Spotify entegrasyonlarÄ± vardÄ±r.

Åžuan da hangi oyunu oynadÄ±ÄŸÄ±mÄ± veya Spotify hangi ÅŸarkÄ±yÄ± dinlediÄŸimi gÃ¶stermek istedim. Bunu baÅŸarabilmek iÃ§in [Spotify'Ä±n API'sini](https://developer.spotify.com/documentation/web-api/) Next.js [API Yoluyla](https://nextjs.org/docs/api-routes/introduction) entegra etmem gerekmekteydi. Bu gÃ¶nderi sizlerde kendi websitenize spotify now playing ekleyebilmenizi saÄŸlÄ±yacaktÄ±r.

## Uygulama OluÅŸtur

Ã–ncelikle, API ile kimlik doÄŸrulamasÄ± yapmamÄ±z iÃ§in bize kimlik bilgilerimizi verecek bir Spotify uygulamasÄ± oluÅŸturmamÄ±z gerekmektedir.

- [Spotfiy GeliÅŸtirme PortalÄ±na](https://developer.spotify.com/dashboard/) gidin ve giriÅŸ yapÄ±n.
- **Uygulama OluÅŸtur'a** tÄ±klayÄ±n.
- Spotify uygulamamÄ±zÄ±n adÄ±nÄ± ve aÃ§Ä±klamasÄ±nÄ± belirleyelim ardÄ±ndan oluÅŸtur'a tÄ±klayÄ±n.
- **MÃ¼ÅŸteri kimliÄŸini gÃ¶ster** tÄ±klayÄ±n.
- MÃ¼ÅŸreti kimliÄŸiniz daha sonra size lazÄ±m olucaktÄ±r.
- AyalarÄ± **DÃ¼zenle** tÄ±kalayÄ±n arÄ±ndan:
  - `https://localhost:3000` Yeniden yÃ¶nlendirme URI'si olarak ekleyin.

Hepsi tamam! ðŸŽ‰ ArtÄ±k dÃ¼zgÃ¼n yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir Spotify uygulamasÄ±na sahipsiniz.

Kimlik doÄŸrulama
UygulamanÄ±za baÄŸlÄ± olarak Spotify API ile kimlik doÄŸrulamanÄ±n Ã§eÅŸitli yollarÄ± vardÄ±r. YalnÄ±zca bir kez izin verilmesine ihtiyacÄ±mÄ±z olduÄŸundan dolayÄ±, "Yetkilendirme Kodu AkÄ±ÅŸÄ±nÄ±" kullanÄ±caÄŸÄ±z.

Ã–ncelikle ihtiyacÄ±mÄ±z olan kapsamlar ile giriÅŸ yaparak uygulama istek yetkimizi alacaÄŸÄ±z iÅŸte URL'nin nasÄ±l gÃ¶rÃ¼nebileceÄŸini dair bir Ã¶rnek. Kendiniz iÃ§in `client_id` ve kapsamlarÄ± deÄŸiÅŸtirin.

```
https://accounts.spotify.com/authorize?client_id=e8f7664cf9a046a488360b0724804ef6
&response_type=code&redirect_uri=http
%3A%2F%2Flocalhost:3000&scope=user-read-currently-playing%20
user-top-read
```

Yetki verdikten sonra, tekrar "redirect_uri" URL'de bir "code" sorgu parametresi var. Bu deÄŸeri kaydedin.

```
http://localhost:3000/callback?code=AQCI5..L2p03
```

ArdÄ±ndan, yenileme belirtecini almamÄ±z gerekecek. Daha Ã¶nceki istemci kimliÄŸini ve sÄ±rrÄ±nÄ± iÃ§eren bir Base64 kodlu dize oluÅŸturmanÄ±z gerekecek. [Base64 Ã§evrimiÃ§i kod](https://www.base64encode.org/) BiÃ§im `client_id:client_secret` ÅŸeklinde olmalÄ±dÄ±r.

```
curl -H "Authorization: Basic CHANGE_BASE64_HERE"
-d grant_type=authorization_code -d code=CHANGE_CODE_HERE -d redirect_uri=http%3A
%2F%2Flocalhost:3000 https://accounts.spotify.com/api/token
```

![Spotify API Code](https://media.discordapp.net/attachments/1012381491684192358/1012381543978774619/terminal.png?width=768&height=403)

Bunun gibi bir JSON alacaksÄ±nÄ±z:

```json
{
  "access_token": "BQDKxO7h1I1wA3esGK9zCFWn97XORJEPjwAHAEIxCnDXcmy9GbEuPacquwWvpiM4d33gJVHVOP9KUxY8AXkpXc-_zRFZBfneHM2vEeV1Fbfr-0Mw94oimlNf77dRiyxPpm4IUVNLloUWgYcfkAO0",
  "token_type": "Bearer",
  "expires_in": 3600,
  "refresh_token": "AQAtxXvnzRTt4c2-2_Av2WyJQKWxUW_hMVN6QNiqv2i8A2ZElVarmvdhqyc8Pf-Z5n827FTFxTpHq5E3kOsrlRWM3TuJWxjVQsW0icR0zo3BXRFLt2FB2Qfj-pFaZwY-qc8",
  "scope": "user-read-currently-playing"
}
```

Bu, iÃ§eren bir JSON yanÄ±tÄ± dÃ¶ndÃ¼rÃ¼r. `refresh_token` Bu belirteÃ§, eriÅŸimi iptal etmediÄŸiniz sÃ¼rece [sÃ¼resiz olarak geÃ§erlidir,](https://developer.spotify.com/community/news/2016/07/25/app-ready-token-revoke/) bu nedenle bunu bir ortam deÄŸiÅŸkenine kaydetmek isteyeceÄŸiz.

## Spotify'Ä±n API'sini kullanma

Sonunda, bazÄ± gerÃ§ek veriler elde ediyoruz! Next.js iÃ§inde dosyanÄ±zda Ã¼c yeni deÄŸer oluÅŸturun `.env.local` .

```json
SPOTIFY_CLIENT_ID=
SPOTIFY_CLIENT_SECRET=
SPOTIFY_REFRESH_TOKEN=
```

> Daha Ã¶nce Next'te ortam deÄŸiÅŸkenleriyle Ã§alÄ±ÅŸmadÄ±ysanÄ±z, [okuyun.](https://nextjs.org/docs/basic-features/environment-variables)

ArtÄ±k mÃ¼ÅŸteri kimliÄŸimiz ve mÃ¼ÅŸteri sÄ±rrÄ±mÄ±z `refresh_token` .

"pages/api/spotify.js"

```javascript
import querystring from "querystring";

const {
  SPOTIFY_CLIENT_ID: client_id,
  SPOTIFY_CLIENT_SECRET: client_secret,
  SPOTIFY_REFRESH_TOKEN: refresh_token,
} = process.env;

const basic = Buffer.from(`${client_id}:${client_secret}`).toString("base64");
const NOW_PLAYING_ENDPOINT = `https://api.spotify.com/v1/me/player/currently-playing`;
const TOKEN_ENDPOINT = `https://accounts.spotify.com/api/token`;

const getAccessToken = async () => {
  const response = await fetch(TOKEN_ENDPOINT, {
    method: "POST",
    headers: {
      Authorization: `Basic ${basic}`,
      "Content-Type": "application/x-www-form-urlencoded",
    },
    body: querystring.stringify({
      grant_type: "refresh_token",
      refresh_token,
    }),
  });

  return response.json();
};

export const getNowPlaying = async () => {
  const { access_token } = await getAccessToken();

  return fetch(NOW_PLAYING_ENDPOINT, {
    headers: {
      Authorization: `Bearer ${access_token}`,
    },
  });
};

export default async (_, res) => {
  const response = await getNowPlaying();

  if (response.status === 204 || response.status > 400) {
    return res.status(200).json({ isPlaying: false });
  }

  const song = await response.json();
  const isPlaying = song.is_playing;
  const title = song.item.name;
  const artist = song.item.artists.map((_artist) => _artist.name).join(", ");
  const album = song.item.album.name;
  const albumImageUrl = song.item.album.images[0].url;
  const songUrl = song.item.external_urls.spotify;

  return res.status(200).json({
    album,
    albumImageUrl,
    artist,
    isPlaying,
    songUrl,
    title,
  });
};
```

"components/spotify.js"

```javascript
{ NextSeo } from 'next-seo';
import useSWR from 'swr';
import { SiSpotify } from 'react-icons/si';

export default function Home() {
    const fetcher = (url) => fetch(url).then((r) => r.json());
    const { data } = useSWR('./pages/api/spotify', fetcher);
    return (
    <div>
        <NextSeo />
            <section className='full-container'>
                <a
                 target='_blank'
                 rel='noopener noreferer'
                 className='relative flex items-center pb-5 space-x-4 rounded-md'
                >
                <div className='w-16'>
                  {data?.isPlaying ? (
                    <img
                     className='w-16'
                     src={data?.albumImageUrl}
                     alt={data?.album}
                    />
                  ) : (
                    <SiSpotify size={60} color={'#1ED760'} />
                  )}
                </div>
                    <div>
                        <p className='text-xl leading-7 dark:text-white text-black'>
                           {data?.isPlaying ? data.artist : 'Spotify'}
                        </p>
                        <p className='text-zinc-500 dark:text-zinc-50'>
                           {data?.isPlaying ? data.title : 'Not Listening'}
                        </p>
                    </div>
                </a>
            </section>
    </div>
    );
}
```

### Ã–rnek

[Kaynak kodlarÄ± burada mevcuttur.](https://github.com/AdemCanCertel)
